{"ast":null,"code":"import { append, addClass, remove, isNullOrUndefined, setStyleAttribute, createElement } from '@syncfusion/ej2-base';\nimport { isBlazor } from '@syncfusion/ej2-base';\nimport * as events from '../base/constant';\nimport * as cls from '../base/css-constant';\nimport * as util from '../base/util';\n/**\n * Virtual Scroll\n */\n\nvar VirtualScroll =\n/** @class */\nfunction () {\n  function VirtualScroll(parent) {\n    this.translateY = 0;\n    this.itemSize = 60;\n    this.bufferCount = 3;\n    this.renderedLength = 0;\n    this.averageRowHeight = 0;\n    this.startIndex = 0;\n    this.isScrollHeightNull = true;\n    this.previousTop = 0;\n    this.parent = parent;\n    this.addEventListener();\n  }\n\n  VirtualScroll.prototype.addEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.on(events.virtualScroll, this.virtualScrolling, this);\n  };\n\n  VirtualScroll.prototype.removeEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.off(events.virtualScroll, this.virtualScrolling);\n  };\n\n  VirtualScroll.prototype.getRenderedCount = function () {\n    if (isBlazor()) {\n      var conTable = this.parent.element.querySelector('.' + cls.CONTENT_TABLE_CLASS);\n      this.renderedLength = conTable.querySelector('tbody').children.length;\n      return this.renderedLength;\n    }\n\n    this.setItemSize();\n    return Math.ceil(this.parent.element.clientHeight / this.itemSize) + this.bufferCount;\n  };\n\n  VirtualScroll.prototype.triggerScrolling = function () {\n    this.parent.showSpinner(); // tslint:disable-next-line:no-any\n\n    var scheduleObj = this.parent;\n    var adaptor = 'interopAdaptor';\n    var invokeMethodAsync = 'invokeMethodAsync';\n    scheduleObj[adaptor][invokeMethodAsync]('OnContentUpdate', this.startIndex);\n  };\n\n  VirtualScroll.prototype.setTranslateValue = function () {\n    var resWrap = this.parent.element.querySelector('.' + cls.RESOURCE_COLUMN_WRAP_CLASS);\n    var conWrap = this.parent.element.querySelector('.' + cls.CONTENT_WRAP_CLASS);\n    var eventWrap = this.parent.element.querySelector('.' + cls.EVENT_TABLE_CLASS);\n    var timeIndicator = this.parent.element.querySelector('.' + cls.CURRENT_TIMELINE_CLASS);\n    this.renderVirtualTrackHeight(conWrap, resWrap);\n    this.setTranslate(resWrap, conWrap, eventWrap, timeIndicator);\n  };\n\n  VirtualScroll.prototype.renderVirtualTrackHeight = function (contentWrap, resourceWrap) {\n    this.parent.resourceBase.setExpandedResources();\n\n    if (this.isScrollHeightNull) {\n      var wrap = createElement('div', {\n        className: cls.VIRTUAL_TRACK_CLASS\n      });\n      var resWrap = [].slice.call(resourceWrap.querySelectorAll('table td'));\n      var startIndex = parseInt(resWrap[0].getAttribute('data-group-index'), 10);\n      var endIndex = parseInt(resWrap[resWrap.length - 1].getAttribute('data-group-index'), 10);\n      this.parent.resourceBase.renderedResources = this.parent.resourceBase.expandedResources.slice(startIndex, endIndex + 1);\n      this.setItemSize();\n      wrap.style.height = this.parent.resourceBase.expandedResources.length * this.itemSize + 'px';\n      this.isScrollHeightNull = false;\n      var virtual = this.parent.element.querySelector('.' + cls.VIRTUAL_TRACK_CLASS);\n\n      if (!isNullOrUndefined(virtual)) {\n        remove(virtual);\n      }\n\n      contentWrap.appendChild(wrap);\n    }\n  };\n\n  VirtualScroll.prototype.renderVirtualTrack = function (contentWrap) {\n    var wrap = createElement('div', {\n      className: cls.VIRTUAL_TRACK_CLASS\n    });\n    wrap.style.height = this.parent.resourceBase.expandedResources.length * this.itemSize + 'px';\n    contentWrap.appendChild(wrap);\n  };\n\n  VirtualScroll.prototype.updateVirtualScrollHeight = function () {\n    var virtual = this.parent.element.querySelector('.' + cls.VIRTUAL_TRACK_CLASS);\n    var lastResourceIndex = this.parent.resourceBase.expandedResources[this.parent.resourceBase.expandedResources.length - 1].groupIndex;\n    var lastRenderIndex = this.parent.resourceBase.renderedResources[this.parent.resourceBase.renderedResources.length - 1].groupIndex;\n\n    if (lastRenderIndex !== lastResourceIndex || isBlazor()) {\n      var conTable = this.parent.element.querySelector('.' + cls.CONTENT_TABLE_CLASS);\n      this.renderedLength = conTable.querySelector('tbody').children.length;\n      virtual.style.height = conTable.offsetHeight + (this.parent.resourceBase.expandedResources.length - this.renderedLength) * conTable.offsetHeight / this.renderedLength + 'px';\n    } else {\n      virtual.style.height = '';\n    }\n\n    this.averageRowHeight = virtual.offsetHeight / this.parent.resourceBase.expandedResources.length;\n  };\n\n  VirtualScroll.prototype.updateVirtualTrackHeight = function (wrap) {\n    var resourceCount = this.parent.resourceBase.renderedResources.length;\n\n    if (resourceCount !== this.getRenderedCount()) {\n      wrap.style.height = this.parent.element.querySelector('.e-content-wrap').clientHeight + 'px';\n      var resWrap = this.parent.element.querySelector('.' + cls.RESOURCE_COLUMN_WRAP_CLASS);\n      var conWrap = this.parent.element.querySelector('.' + cls.CONTENT_WRAP_CLASS);\n      var eventWrap = this.parent.element.querySelector('.' + cls.EVENT_TABLE_CLASS);\n      this.translateY = 0;\n      this.setTranslate(resWrap, conWrap, eventWrap);\n    } else {\n      var lastRenderIndex = this.parent.resourceBase.renderedResources[resourceCount - 1].groupIndex;\n      var lastCollIndex = this.parent.resourceBase.expandedResources[this.parent.resourceBase.expandedResources.length - 1].groupIndex;\n      var renderedResConut = resourceCount + (lastCollIndex - lastRenderIndex);\n      renderedResConut = renderedResConut > this.parent.resourceBase.expandedResources.length ? this.parent.resourceBase.expandedResources.length : renderedResConut;\n      wrap.style.height = renderedResConut * this.itemSize + 'px';\n    }\n  };\n\n  VirtualScroll.prototype.setItemSize = function () {\n    this.itemSize = util.getElementHeightFromClass(this.parent.activeView.element, cls.WORK_CELLS_CLASS) || this.itemSize;\n  };\n\n  VirtualScroll.prototype.beforeInvoke = function (resWrap, conWrap, eventWrap, timeIndicator) {\n    var _this = this;\n\n    if (isBlazor()) {\n      clearTimeout(this.timeValue);\n      this.timeValue = setTimeout(function () {\n        _this.triggerScrolling();\n      }, 250);\n      this.setTranslate(resWrap, conWrap, eventWrap, timeIndicator);\n      this.previousTop = conWrap.scrollTop;\n    }\n  };\n\n  VirtualScroll.prototype.virtualScrolling = function () {\n    var _this = this;\n\n    this.parent.quickPopup.quickPopupHide();\n    this.parent.quickPopup.morePopup.hide();\n    var resWrap = this.parent.element.querySelector('.' + cls.RESOURCE_COLUMN_WRAP_CLASS);\n    var conWrap = this.parent.element.querySelector('.' + cls.CONTENT_WRAP_CLASS);\n    var eventWrap = this.parent.element.querySelector('.' + cls.EVENT_TABLE_CLASS);\n    var timeIndicator = this.parent.element.querySelector('.' + cls.CURRENT_TIMELINE_CLASS);\n    var conTable = this.parent.element.querySelector('.' + cls.CONTENT_TABLE_CLASS);\n    this.renderedLength = resWrap.querySelector('tbody').children.length;\n    var firstTDIndex = parseInt(resWrap.querySelector('tbody td').getAttribute('data-group-index'), 10);\n    var scrollHeight = this.parent.rowAutoHeight ? conTable.offsetHeight - conWrap.offsetHeight : this.bufferCount * this.itemSize;\n    addClass([conWrap], 'e-transition');\n\n    if (isBlazor()) {\n      this.setItemSize();\n    }\n\n    var resCollection = [];\n\n    if (conWrap.scrollTop - this.translateY < 0) {\n      resCollection = this.upScroll(conWrap, firstTDIndex);\n      this.beforeInvoke(resWrap, conWrap, eventWrap, timeIndicator);\n    } else if (conWrap.scrollTop - this.translateY > scrollHeight) {\n      resCollection = this.downScroll(conWrap, firstTDIndex);\n\n      if (!(this.previousTop === conWrap.scrollTop)) {\n        this.beforeInvoke(resWrap, conWrap, eventWrap, timeIndicator);\n      }\n    }\n\n    if (!isBlazor()) {\n      if (!isNullOrUndefined(resCollection) && resCollection.length > 0) {\n        this.parent.showSpinner();\n        this.updateContent(resWrap, conWrap, eventWrap, resCollection);\n        this.setTranslate(resWrap, conWrap, eventWrap, timeIndicator);\n        this.parent.notify(events.dataReady, {});\n\n        if (this.parent.dragAndDropModule && this.parent.dragAndDropModule.actionObj.action === 'drag') {\n          this.parent.dragAndDropModule.navigationWrapper();\n        }\n\n        window.clearTimeout(this.timeValue);\n        this.timeValue = window.setTimeout(function () {\n          _this.parent.hideSpinner();\n        }, 250);\n      }\n    }\n  };\n\n  VirtualScroll.prototype.upScroll = function (conWrap, firstTDIndex) {\n    var index = 0;\n\n    if (isBlazor()) {\n      index = ~~(conWrap.scrollTop / this.itemSize);\n    } else {\n      index = ~~(conWrap.scrollTop / this.itemSize) + Math.ceil(conWrap.clientHeight / this.itemSize) - this.renderedLength;\n    }\n\n    if (this.parent.rowAutoHeight) {\n      index = index > firstTDIndex ? firstTDIndex - this.bufferCount : index;\n    }\n\n    index = index > 0 ? index : 0;\n    var prevSetCollection = this.getBufferCollection(index, index + this.renderedLength);\n    this.parent.resourceBase.renderedResources = prevSetCollection;\n\n    if (firstTDIndex === 0) {\n      this.translateY = conWrap.scrollTop;\n    } else {\n      var height = this.parent.rowAutoHeight ? this.averageRowHeight : this.itemSize;\n      this.translateY = conWrap.scrollTop - this.bufferCount * height > 0 ? conWrap.scrollTop - this.bufferCount * height : 0;\n    }\n\n    if (isBlazor()) {\n      this.startIndex = index;\n    }\n\n    return prevSetCollection;\n  };\n\n  VirtualScroll.prototype.downScroll = function (conWrap, firstTDIndex) {\n    var lastResource = this.parent.resourceBase.renderedResources[this.parent.resourceBase.renderedResources.length - 1].groupIndex;\n    var lastResourceIndex = this.parent.resourceBase.expandedResources[this.parent.resourceBase.expandedResources.length - 1].groupIndex;\n\n    if (lastResource === lastResourceIndex) {\n      return null;\n    }\n\n    var nextSetResIndex = 0;\n    var height = this.parent.rowAutoHeight ? this.averageRowHeight : this.itemSize;\n\n    if (isBlazor()) {\n      nextSetResIndex = ~~(conWrap.scrollTop / height);\n    } else {\n      nextSetResIndex = ~~(conWrap.scrollTop / this.itemSize);\n\n      if (this.parent.rowAutoHeight) {\n        nextSetResIndex = ~~((conWrap.scrollTop - this.translateY) / this.averageRowHeight) + firstTDIndex;\n        nextSetResIndex = nextSetResIndex > firstTDIndex + this.bufferCount ? nextSetResIndex : firstTDIndex + this.bufferCount;\n      }\n    }\n\n    var lastIndex = nextSetResIndex + this.renderedLength;\n    lastIndex = lastIndex > this.parent.resourceBase.expandedResources.length ? nextSetResIndex + (this.parent.resourceBase.expandedResources.length - nextSetResIndex) : lastIndex;\n    var nextSetCollection = this.getBufferCollection(lastIndex - this.renderedLength, lastIndex);\n    this.translateY = conWrap.scrollTop;\n\n    if (isBlazor()) {\n      if (this.translateY > this.parent.resourceBase.expandedResources.length * height - this.renderedLength * height) {\n        this.translateY = this.parent.resourceBase.expandedResources.length * height - this.renderedLength * height;\n      }\n\n      this.startIndex = lastIndex - this.renderedLength;\n      this.parent.resourceBase.renderedResources = nextSetCollection;\n    }\n\n    return nextSetCollection;\n  };\n\n  VirtualScroll.prototype.updateContent = function (resWrap, conWrap, eventWrap, resCollection) {\n    var renderedLenth = resWrap.querySelector('tbody').children.length;\n\n    for (var i = 0; i < renderedLenth; i++) {\n      remove(resWrap.querySelector('tbody tr'));\n      remove(conWrap.querySelector('tbody tr'));\n      remove(eventWrap.querySelector('div'));\n    }\n\n    this.parent.resourceBase.renderedResources = resCollection;\n    var resourceRows = this.parent.resourceBase.getContentRows(resCollection);\n    var contentRows = this.parent.activeView.getContentRows();\n    var eventRows = this.parent.activeView.getEventRows(resCollection.length);\n    append(resourceRows, resWrap.querySelector('tbody'));\n    append(contentRows, conWrap.querySelector('tbody'));\n    append(eventRows, eventWrap);\n  };\n\n  VirtualScroll.prototype.getBufferCollection = function (startIndex, endIndex) {\n    return this.parent.resourceBase.expandedResources.slice(startIndex, endIndex);\n  };\n\n  VirtualScroll.prototype.setTranslate = function (resWrap, conWrap, eventWrap, timeIndicator) {\n    setStyleAttribute(resWrap.querySelector('table'), {\n      transform: \"translateY(\" + this.translateY + \"px)\"\n    });\n    setStyleAttribute(conWrap.querySelector('table'), {\n      transform: \"translateY(\" + this.translateY + \"px)\"\n    });\n    setStyleAttribute(eventWrap, {\n      transform: \"translateY(\" + this.translateY + \"px)\"\n    });\n\n    if (!isNullOrUndefined(timeIndicator)) {\n      setStyleAttribute(timeIndicator, {\n        transform: \"translateY(\" + this.translateY + \"px)\"\n      });\n    }\n  };\n\n  VirtualScroll.prototype.destroy = function () {\n    this.removeEventListener();\n  };\n\n  return VirtualScroll;\n}();\n\nexport { VirtualScroll };","map":{"version":3,"sources":["C:/Users/rraval/Desktop/schedule-component-copy/node_modules/@syncfusion/ej2-schedule/src/schedule/actions/virtual-scroll.js"],"names":["append","addClass","remove","isNullOrUndefined","setStyleAttribute","createElement","isBlazor","events","cls","util","VirtualScroll","parent","translateY","itemSize","bufferCount","renderedLength","averageRowHeight","startIndex","isScrollHeightNull","previousTop","addEventListener","prototype","isDestroyed","on","virtualScroll","virtualScrolling","removeEventListener","off","getRenderedCount","conTable","element","querySelector","CONTENT_TABLE_CLASS","children","length","setItemSize","Math","ceil","clientHeight","triggerScrolling","showSpinner","scheduleObj","adaptor","invokeMethodAsync","setTranslateValue","resWrap","RESOURCE_COLUMN_WRAP_CLASS","conWrap","CONTENT_WRAP_CLASS","eventWrap","EVENT_TABLE_CLASS","timeIndicator","CURRENT_TIMELINE_CLASS","renderVirtualTrackHeight","setTranslate","contentWrap","resourceWrap","resourceBase","setExpandedResources","wrap","className","VIRTUAL_TRACK_CLASS","slice","call","querySelectorAll","parseInt","getAttribute","endIndex","renderedResources","expandedResources","style","height","virtual","appendChild","renderVirtualTrack","updateVirtualScrollHeight","lastResourceIndex","groupIndex","lastRenderIndex","offsetHeight","updateVirtualTrackHeight","resourceCount","lastCollIndex","renderedResConut","getElementHeightFromClass","activeView","WORK_CELLS_CLASS","beforeInvoke","_this","clearTimeout","timeValue","setTimeout","scrollTop","quickPopup","quickPopupHide","morePopup","hide","firstTDIndex","scrollHeight","rowAutoHeight","resCollection","upScroll","downScroll","updateContent","notify","dataReady","dragAndDropModule","actionObj","action","navigationWrapper","window","hideSpinner","index","prevSetCollection","getBufferCollection","lastResource","nextSetResIndex","lastIndex","nextSetCollection","renderedLenth","i","resourceRows","getContentRows","contentRows","eventRows","getEventRows","transform","destroy"],"mappings":"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","sourcesContent":["import { append, addClass, remove, isNullOrUndefined, setStyleAttribute, createElement } from '@syncfusion/ej2-base';\nimport { isBlazor } from '@syncfusion/ej2-base';\nimport * as events from '../base/constant';\nimport * as cls from '../base/css-constant';\nimport * as util from '../base/util';\n/**\n * Virtual Scroll\n */\nvar VirtualScroll = /** @class */ (function () {\n    function VirtualScroll(parent) {\n        this.translateY = 0;\n        this.itemSize = 60;\n        this.bufferCount = 3;\n        this.renderedLength = 0;\n        this.averageRowHeight = 0;\n        this.startIndex = 0;\n        this.isScrollHeightNull = true;\n        this.previousTop = 0;\n        this.parent = parent;\n        this.addEventListener();\n    }\n    VirtualScroll.prototype.addEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.on(events.virtualScroll, this.virtualScrolling, this);\n    };\n    VirtualScroll.prototype.removeEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.off(events.virtualScroll, this.virtualScrolling);\n    };\n    VirtualScroll.prototype.getRenderedCount = function () {\n        if (isBlazor()) {\n            var conTable = this.parent.element.querySelector('.' + cls.CONTENT_TABLE_CLASS);\n            this.renderedLength = conTable.querySelector('tbody').children.length;\n            return this.renderedLength;\n        }\n        this.setItemSize();\n        return Math.ceil(this.parent.element.clientHeight / this.itemSize) + this.bufferCount;\n    };\n    VirtualScroll.prototype.triggerScrolling = function () {\n        this.parent.showSpinner();\n        // tslint:disable-next-line:no-any\n        var scheduleObj = this.parent;\n        var adaptor = 'interopAdaptor';\n        var invokeMethodAsync = 'invokeMethodAsync';\n        scheduleObj[adaptor][invokeMethodAsync]('OnContentUpdate', this.startIndex);\n    };\n    VirtualScroll.prototype.setTranslateValue = function () {\n        var resWrap = this.parent.element.querySelector('.' + cls.RESOURCE_COLUMN_WRAP_CLASS);\n        var conWrap = this.parent.element.querySelector('.' + cls.CONTENT_WRAP_CLASS);\n        var eventWrap = this.parent.element.querySelector('.' + cls.EVENT_TABLE_CLASS);\n        var timeIndicator = this.parent.element.querySelector('.' + cls.CURRENT_TIMELINE_CLASS);\n        this.renderVirtualTrackHeight(conWrap, resWrap);\n        this.setTranslate(resWrap, conWrap, eventWrap, timeIndicator);\n    };\n    VirtualScroll.prototype.renderVirtualTrackHeight = function (contentWrap, resourceWrap) {\n        this.parent.resourceBase.setExpandedResources();\n        if (this.isScrollHeightNull) {\n            var wrap = createElement('div', { className: cls.VIRTUAL_TRACK_CLASS });\n            var resWrap = [].slice.call((resourceWrap).querySelectorAll('table td'));\n            var startIndex = parseInt(resWrap[0].getAttribute('data-group-index'), 10);\n            var endIndex = parseInt(resWrap[resWrap.length - 1].getAttribute('data-group-index'), 10);\n            this.parent.resourceBase.renderedResources = this.parent.resourceBase.expandedResources.slice(startIndex, endIndex + 1);\n            this.setItemSize();\n            wrap.style.height = (this.parent.resourceBase.expandedResources.length * this.itemSize) + 'px';\n            this.isScrollHeightNull = false;\n            var virtual = this.parent.element.querySelector('.' + cls.VIRTUAL_TRACK_CLASS);\n            if (!isNullOrUndefined(virtual)) {\n                remove(virtual);\n            }\n            contentWrap.appendChild(wrap);\n        }\n    };\n    VirtualScroll.prototype.renderVirtualTrack = function (contentWrap) {\n        var wrap = createElement('div', { className: cls.VIRTUAL_TRACK_CLASS });\n        wrap.style.height = (this.parent.resourceBase.expandedResources.length * this.itemSize) + 'px';\n        contentWrap.appendChild(wrap);\n    };\n    VirtualScroll.prototype.updateVirtualScrollHeight = function () {\n        var virtual = this.parent.element.querySelector('.' + cls.VIRTUAL_TRACK_CLASS);\n        var lastResourceIndex = this.parent.resourceBase.expandedResources[this.parent.resourceBase.expandedResources.length - 1].groupIndex;\n        var lastRenderIndex = this.parent.resourceBase.renderedResources[this.parent.resourceBase.renderedResources.length - 1].groupIndex;\n        if (lastRenderIndex !== lastResourceIndex || isBlazor()) {\n            var conTable = this.parent.element.querySelector('.' + cls.CONTENT_TABLE_CLASS);\n            this.renderedLength = conTable.querySelector('tbody').children.length;\n            virtual.style.height = (conTable.offsetHeight + (this.parent.resourceBase.expandedResources.length - (this.renderedLength)) *\n                conTable.offsetHeight / this.renderedLength) + 'px';\n        }\n        else {\n            virtual.style.height = '';\n        }\n        this.averageRowHeight = virtual.offsetHeight / this.parent.resourceBase.expandedResources.length;\n    };\n    VirtualScroll.prototype.updateVirtualTrackHeight = function (wrap) {\n        var resourceCount = this.parent.resourceBase.renderedResources.length;\n        if (resourceCount !== this.getRenderedCount()) {\n            wrap.style.height = this.parent.element.querySelector('.e-content-wrap').clientHeight + 'px';\n            var resWrap = this.parent.element.querySelector('.' + cls.RESOURCE_COLUMN_WRAP_CLASS);\n            var conWrap = this.parent.element.querySelector('.' + cls.CONTENT_WRAP_CLASS);\n            var eventWrap = this.parent.element.querySelector('.' + cls.EVENT_TABLE_CLASS);\n            this.translateY = 0;\n            this.setTranslate(resWrap, conWrap, eventWrap);\n        }\n        else {\n            var lastRenderIndex = this.parent.resourceBase.renderedResources[resourceCount - 1].groupIndex;\n            var lastCollIndex = this.parent.resourceBase.expandedResources[this.parent.resourceBase.expandedResources.length - 1].groupIndex;\n            var renderedResConut = resourceCount + (lastCollIndex - lastRenderIndex);\n            renderedResConut = (renderedResConut > this.parent.resourceBase.expandedResources.length) ?\n                this.parent.resourceBase.expandedResources.length : renderedResConut;\n            wrap.style.height = (renderedResConut * this.itemSize) + 'px';\n        }\n    };\n    VirtualScroll.prototype.setItemSize = function () {\n        this.itemSize = util.getElementHeightFromClass(this.parent.activeView.element, cls.WORK_CELLS_CLASS) || this.itemSize;\n    };\n    VirtualScroll.prototype.beforeInvoke = function (resWrap, conWrap, eventWrap, timeIndicator) {\n        var _this = this;\n        if (isBlazor()) {\n            clearTimeout(this.timeValue);\n            this.timeValue = setTimeout(function () { _this.triggerScrolling(); }, 250);\n            this.setTranslate(resWrap, conWrap, eventWrap, timeIndicator);\n            this.previousTop = conWrap.scrollTop;\n        }\n    };\n    VirtualScroll.prototype.virtualScrolling = function () {\n        var _this = this;\n        this.parent.quickPopup.quickPopupHide();\n        this.parent.quickPopup.morePopup.hide();\n        var resWrap = this.parent.element.querySelector('.' + cls.RESOURCE_COLUMN_WRAP_CLASS);\n        var conWrap = this.parent.element.querySelector('.' + cls.CONTENT_WRAP_CLASS);\n        var eventWrap = this.parent.element.querySelector('.' + cls.EVENT_TABLE_CLASS);\n        var timeIndicator = this.parent.element.querySelector('.' + cls.CURRENT_TIMELINE_CLASS);\n        var conTable = this.parent.element.querySelector('.' + cls.CONTENT_TABLE_CLASS);\n        this.renderedLength = resWrap.querySelector('tbody').children.length;\n        var firstTDIndex = parseInt(resWrap.querySelector('tbody td').getAttribute('data-group-index'), 10);\n        var scrollHeight = this.parent.rowAutoHeight ?\n            (conTable.offsetHeight - conWrap.offsetHeight) : this.bufferCount * this.itemSize;\n        addClass([conWrap], 'e-transition');\n        if (isBlazor()) {\n            this.setItemSize();\n        }\n        var resCollection = [];\n        if ((conWrap.scrollTop) - this.translateY < 0) {\n            resCollection = this.upScroll(conWrap, firstTDIndex);\n            this.beforeInvoke(resWrap, conWrap, eventWrap, timeIndicator);\n        }\n        else if (conWrap.scrollTop - this.translateY > scrollHeight) {\n            resCollection = this.downScroll(conWrap, firstTDIndex);\n            if (!(this.previousTop === conWrap.scrollTop)) {\n                this.beforeInvoke(resWrap, conWrap, eventWrap, timeIndicator);\n            }\n        }\n        if (!isBlazor()) {\n            if (!isNullOrUndefined(resCollection) && resCollection.length > 0) {\n                this.parent.showSpinner();\n                this.updateContent(resWrap, conWrap, eventWrap, resCollection);\n                this.setTranslate(resWrap, conWrap, eventWrap, timeIndicator);\n                this.parent.notify(events.dataReady, {});\n                if (this.parent.dragAndDropModule && this.parent.dragAndDropModule.actionObj.action === 'drag') {\n                    this.parent.dragAndDropModule.navigationWrapper();\n                }\n                window.clearTimeout(this.timeValue);\n                this.timeValue = window.setTimeout(function () { _this.parent.hideSpinner(); }, 250);\n            }\n        }\n    };\n    VirtualScroll.prototype.upScroll = function (conWrap, firstTDIndex) {\n        var index = 0;\n        if (isBlazor()) {\n            index = ~~(conWrap.scrollTop / this.itemSize);\n        }\n        else {\n            index = (~~(conWrap.scrollTop / this.itemSize) + Math.ceil(conWrap.clientHeight / this.itemSize)) - this.renderedLength;\n        }\n        if (this.parent.rowAutoHeight) {\n            index = (index > firstTDIndex) ? firstTDIndex - this.bufferCount : index;\n        }\n        index = (index > 0) ? index : 0;\n        var prevSetCollection = this.getBufferCollection(index, index + this.renderedLength);\n        this.parent.resourceBase.renderedResources = prevSetCollection;\n        if (firstTDIndex === 0) {\n            this.translateY = conWrap.scrollTop;\n        }\n        else {\n            var height = (this.parent.rowAutoHeight) ? this.averageRowHeight : this.itemSize;\n            this.translateY = (conWrap.scrollTop - (this.bufferCount * height) > 0) ?\n                conWrap.scrollTop - (this.bufferCount * height) : 0;\n        }\n        if (isBlazor()) {\n            this.startIndex = index;\n        }\n        return prevSetCollection;\n    };\n    VirtualScroll.prototype.downScroll = function (conWrap, firstTDIndex) {\n        var lastResource = this.parent.resourceBase.\n            renderedResources[this.parent.resourceBase.renderedResources.length - 1].groupIndex;\n        var lastResourceIndex = this.parent.resourceBase.expandedResources[this.parent.resourceBase.expandedResources.length - 1].groupIndex;\n        if (lastResource === lastResourceIndex) {\n            return null;\n        }\n        var nextSetResIndex = 0;\n        var height = (this.parent.rowAutoHeight) ? this.averageRowHeight : this.itemSize;\n        if (isBlazor()) {\n            nextSetResIndex = ~~(conWrap.scrollTop / height);\n        }\n        else {\n            nextSetResIndex = ~~(conWrap.scrollTop / this.itemSize);\n            if (this.parent.rowAutoHeight) {\n                nextSetResIndex = ~~((conWrap.scrollTop - this.translateY) / this.averageRowHeight) + firstTDIndex;\n                nextSetResIndex = (nextSetResIndex > firstTDIndex + this.bufferCount) ? nextSetResIndex : firstTDIndex + this.bufferCount;\n            }\n        }\n        var lastIndex = nextSetResIndex + this.renderedLength;\n        lastIndex = (lastIndex > this.parent.resourceBase.expandedResources.length) ?\n            nextSetResIndex + (this.parent.resourceBase.expandedResources.length - nextSetResIndex) : lastIndex;\n        var nextSetCollection = this.getBufferCollection(lastIndex - this.renderedLength, lastIndex);\n        this.translateY = conWrap.scrollTop;\n        if (isBlazor()) {\n            if (this.translateY > (this.parent.resourceBase.expandedResources.length * height) - (this.renderedLength * height)) {\n                this.translateY = (this.parent.resourceBase.expandedResources.length * height) - (this.renderedLength * height);\n            }\n            this.startIndex = lastIndex - this.renderedLength;\n            this.parent.resourceBase.renderedResources = nextSetCollection;\n        }\n        return nextSetCollection;\n    };\n    VirtualScroll.prototype.updateContent = function (resWrap, conWrap, eventWrap, resCollection) {\n        var renderedLenth = resWrap.querySelector('tbody').children.length;\n        for (var i = 0; i < renderedLenth; i++) {\n            remove(resWrap.querySelector('tbody tr'));\n            remove(conWrap.querySelector('tbody tr'));\n            remove(eventWrap.querySelector('div'));\n        }\n        this.parent.resourceBase.renderedResources = resCollection;\n        var resourceRows = this.parent.resourceBase.getContentRows(resCollection);\n        var contentRows = this.parent.activeView.getContentRows();\n        var eventRows = this.parent.activeView.getEventRows(resCollection.length);\n        append(resourceRows, resWrap.querySelector('tbody'));\n        append(contentRows, conWrap.querySelector('tbody'));\n        append(eventRows, eventWrap);\n    };\n    VirtualScroll.prototype.getBufferCollection = function (startIndex, endIndex) {\n        return this.parent.resourceBase.expandedResources.slice(startIndex, endIndex);\n    };\n    VirtualScroll.prototype.setTranslate = function (resWrap, conWrap, eventWrap, timeIndicator) {\n        setStyleAttribute(resWrap.querySelector('table'), {\n            transform: \"translateY(\" + this.translateY + \"px)\"\n        });\n        setStyleAttribute(conWrap.querySelector('table'), {\n            transform: \"translateY(\" + this.translateY + \"px)\"\n        });\n        setStyleAttribute(eventWrap, {\n            transform: \"translateY(\" + this.translateY + \"px)\"\n        });\n        if (!isNullOrUndefined(timeIndicator)) {\n            setStyleAttribute(timeIndicator, {\n                transform: \"translateY(\" + this.translateY + \"px)\"\n            });\n        }\n    };\n    VirtualScroll.prototype.destroy = function () {\n        this.removeEventListener();\n    };\n    return VirtualScroll;\n}());\nexport { VirtualScroll };\n"]},"metadata":{},"sourceType":"module"}